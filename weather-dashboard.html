<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤©æ°— & ã‚°ãƒ«ãƒ¡ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:      #dce8f4;
      --card:    #ffffff;
      --border:  #c2d4e8;
      --sky:     #0a72c3;
      --sky-lt:  #d0e8fa;
      --warm:    #c0390a;
      --cold:    #0260a8;
      --rain:    #1455b0;
      --gold:    #b06600;
      --t1:      #0d1c2e;
      --t2:      #364e66;
      --t3:      #7090ac;
      --sh:      0 2px 20px rgba(10,60,130,0.10);
      --sh-h:    0 8px 32px rgba(10,60,130,0.18);
    }
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    html, body {
      font-family: 'Inter','Hiragino Kaku Gothic ProN','Meiryo',sans-serif;
      background: var(--bg);
      color: var(--t1);
    }

    .page {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px 24px 40px;
    }

    /* â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 28px;
    }
    .hdr-left  { display:flex; align-items:center; gap:14px; }
    .hdr-icon  {
      width:48px; height:48px;
      background: linear-gradient(135deg,#56b4f0,#0a72c3);
      border-radius:14px;
      display:flex; align-items:center; justify-content:center;
      font-size:1.6rem;
      box-shadow: 0 4px 16px rgba(10,114,195,0.35);
    }
    .hdr-left h1 { font-size:1.4rem; font-weight:800; letter-spacing:-.02em; }
    .hdr-left p  { font-size:0.78rem; color:var(--t3); margin-top:3px; }
    .hdr-right   { display:flex; align-items:center; gap:16px; }
    #last-updated{ font-size:0.78rem; color:var(--t2); font-weight:600; }
    #next-update { font-size:0.7rem; color:var(--t3); }
    .bar-wrap    { width:90px; height:4px; background:var(--border); border-radius:2px; overflow:hidden; }
    .bar-fill    { height:100%; background:linear-gradient(90deg,var(--sky),#00bcd4); transition:width 1s linear; }

    /* â”€â”€ ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã— â”€â”€ */
    .section-label {
      font-size: 0.72rem;
      font-weight: 800;
      letter-spacing: .12em;
      color: var(--t3);
      text-transform: uppercase;
      margin-bottom: 14px;
      padding-left: 4px;
    }

    /* â”€â”€ 2ã‚«ãƒ©ãƒ ã‚°ãƒªãƒƒãƒ‰ â”€â”€ */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    /* â”€â”€ ã‚«ãƒ¼ãƒ‰åŸºæœ¬ â”€â”€ */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 22px;
      overflow: hidden;
      box-shadow: var(--sh);
      display: flex;
      flex-direction: column;
      transition: box-shadow .2s, transform .2s;
    }
    .card:hover { box-shadow: var(--sh-h); transform: translateY(-3px); }

    /* â”€â”€ ã‚«ãƒ¼ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼å¸¯ â”€â”€ */
    .card-head {
      padding: 16px 20px 14px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-head.wx      { background: linear-gradient(135deg,#cce8fa 0%,#fff 65%); }
    .card-head.gourmet { background: linear-gradient(135deg,#fff2d6 0%,#fff 65%); }

    .ch-icon { font-size:1.6rem; }
    .ch-name { font-size:1.05rem; font-weight:800; flex:1; }
    .ch-sub  { font-size:0.68rem; color:var(--t3); }
    .ch-tag  {
      font-size:0.65rem; font-weight:700;
      background:#fff2cc; color:var(--gold);
      border:1px solid #f0d070; border-radius:999px; padding:3px 12px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       å¤©æ°—ã‚«ãƒ¼ãƒ‰
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .wx-now {
      display: flex;
      align-items: center;
      padding: 24px 24px 20px;
      gap: 20px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(160deg, #f5fbff 0%, #fff 100%);
    }
    .wx-left   { display:flex; flex-direction:column; align-items:center; gap:6px; flex-shrink:0; }
    .wx-emoji  { font-size: 5rem; line-height:1; filter: drop-shadow(0 3px 8px rgba(0,0,0,.14)); }
    .wx-desc   { font-size:0.82rem; font-weight:700; color:var(--t2); text-align:center; }

    .wx-center { flex:1; }
    .wx-temp-row { display:flex; align-items:baseline; gap:5px; margin-bottom:10px; }
    .wx-temp {
      font-size: 5rem;
      font-weight: 900;
      color: var(--sky);
      line-height: 1;
      letter-spacing: -0.05em;
    }
    .wx-unit { font-size:2rem; font-weight:400; color:var(--t3); }

    .wx-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px 12px;
    }
    .wm { font-size:0.78rem; color:var(--t3); font-weight:500; }
    .wm strong { color:var(--t2); font-weight:700; }

    /* 3æ—¥é–“äºˆå ± */
    .wx-3days {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
    }

    .day-col {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 20px 12px 18px;
      border-right: 1px solid var(--border);
      text-align: center;
      position: relative;
    }
    .day-col:last-child { border-right: none; }
    .day-col.today { background: linear-gradient(180deg, var(--sky-lt) 0%, #eaf4fd 100%); }

    .today-badge {
      position: absolute;
      top: 8px; left: 50%; transform: translateX(-50%);
      font-size: 0.55rem; font-weight:800;
      background: var(--sky); color:#fff;
      border-radius:999px; padding:2px 9px;
      letter-spacing:.05em;
    }

    .dc-label {
      font-size: 0.82rem; font-weight: 800; color: var(--t3);
      margin-top: 12px;
    }
    .day-col.today .dc-label { color: var(--sky); }

    .dc-emoji { font-size: 2.8rem; line-height:1; filter: drop-shadow(0 2px 5px rgba(0,0,0,.12)); }
    .dc-wx    { font-size: 0.72rem; color: var(--t2); font-weight:600; }

    .dc-temps { display:flex; align-items:baseline; gap:8px; }
    .dc-hi { font-size:1.8rem; font-weight:900; color:var(--warm); letter-spacing:-0.03em; }
    .dc-lo { font-size:1.3rem; font-weight:800; color:var(--cold); letter-spacing:-0.02em; }

    .dc-rain-row { display:flex; align-items:center; gap:6px; }
    .dc-rain-pct { font-size:0.75rem; color:var(--rain); font-weight:700; }
    .dc-rain-track { width:50px; height:5px; background:var(--border); border-radius:3px; overflow:hidden; }
    .dc-rain-bar   { height:100%; background:linear-gradient(90deg,#64b5f6,#0a72c3); border-radius:3px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ã‚°ãƒ«ãƒ¡ã‚«ãƒ¼ãƒ‰
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .food-list {
      display: flex;
      flex-direction: column;
      padding: 16px 18px 20px;
      gap: 12px;
    }

    .f-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 16px;
      border-radius: 14px;
      border: 1.5px solid var(--border);
      background: #f8fbff;
      transition: background .15s, border-color .15s, transform .15s, box-shadow .15s;
    }
    .f-item:hover {
      background:#fff7ed;
      border-color:#f5c27a;
      transform:translateX(4px);
      box-shadow: 0 3px 12px rgba(200,140,0,.10);
    }

    .f-rank {
      width:42px; height:42px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:1.1rem; font-weight:900; flex-shrink:0;
    }
    .r1 { background:linear-gradient(135deg,#fff3c2,#ffe066); color:#8a5c00; border:2px solid #f5c400; box-shadow:0 3px 10px rgba(200,160,0,.3); }
    .r2 { background:linear-gradient(135deg,#eef1f5,#d8e0ea); color:#3d5068; border:2px solid #aab8ca; box-shadow:0 2px 8px rgba(80,100,130,.18); }
    .r3 { background:linear-gradient(135deg,#fde8d8,#f5c9a8); color:#7c3d00; border:2px solid #d4884a; box-shadow:0 2px 8px rgba(180,100,30,.2); }

    .f-body { flex:1; min-width:0; }
    .f-name {
      font-size:0.96rem; font-weight:800; color:var(--t1);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .f-name a {
      color: var(--t1);
      text-decoration: none;
      border-bottom: 1.5px solid var(--border);
      transition: color .15s, border-color .15s;
    }
    .f-name a:hover {
      color: var(--sky);
      border-bottom-color: var(--sky);
    }
    .f-point {
      font-size:0.78rem; color:var(--t2); margin-top:4px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-weight:500;
    }

    .f-right { display:flex; flex-direction:column; align-items:flex-end; gap:5px; flex-shrink:0; }
    .f-genre {
      font-size:0.68rem; font-weight:700;
      background:var(--sky-lt); color:var(--sky);
      border-radius:999px; padding:3px 11px; white-space:nowrap;
    }
    .f-score { font-size:0.82rem; color:#e6a800; font-weight:800; }
    .f-price { font-size:0.68rem; color:var(--t3); font-weight:600; }

    /* â”€â”€ ãƒ­ãƒ¼ãƒ‰ â”€â”€ */
    .loading-wrap {
      min-height: 200px;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:14px; color:var(--t3); font-size:0.84rem;
    }
    .spinner {
      width:32px; height:32px;
      border:3px solid var(--border);
      border-top-color:var(--sky);
      border-radius:50%;
      animation:spin .7s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* â”€â”€ ãƒ•ãƒƒã‚¿ãƒ¼ â”€â”€ */
    footer {
      text-align:center; font-size:0.68rem; color:var(--t3);
      margin-top: 8px;
    }
    footer a { color:var(--sky); text-decoration:none; }

    /* â”€â”€ ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ â”€â”€ */
    @keyframes fadeUp {
      from { opacity:0; transform:translateY(14px); }
      to   { opacity:1; transform:translateY(0); }
    }
    .card { animation:fadeUp .4s ease both; }
    .card:nth-child(1) { animation-delay:.00s; }
    .card:nth-child(2) { animation-delay:.07s; }
    .card:nth-child(3) { animation-delay:.14s; }

    /* â”€â”€ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– â”€â”€ */
    @media (max-width: 640px) {
      .page { padding: 16px 14px 32px; }
      header { flex-direction: column; align-items: flex-start; gap: 10px; margin-bottom: 20px; }
      .hdr-right { width: 100%; justify-content: space-between; }
      .hdr-left h1 { font-size: 1.1rem; }
      .grid { grid-template-columns: 1fr; gap: 14px; }
      .wx-now { padding: 18px 18px 16px; gap: 16px; }
      .wx-emoji { font-size: 4rem; }
      .wx-temp  { font-size: 4rem; }
      .wx-unit  { font-size: 1.6rem; }
      .dc-hi { font-size: 1.5rem; }
      .dc-lo { font-size: 1.1rem; }
      .dc-emoji { font-size: 2.2rem; }
      .day-col { padding: 16px 8px 14px; gap: 8px; }
      .f-item { padding: 12px 14px; }
      .f-name { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
<div class="page">

  <header>
    <div class="hdr-left">
      <div class="hdr-icon">ğŸŒ¤</div>
      <div>
        <h1>Weather &amp; Gourmet Dashboard</h1>
        <p>è±Šæ´² &amp; å²é˜œå¸‚ â€” å¤©æ°—äºˆå ± &amp; ä»Šå­£ãŠã™ã™ã‚ã‚°ãƒ«ãƒ¡</p>
      </div>
    </div>
    <div class="hdr-right">
      <div id="last-updated">èª­ã¿è¾¼ã¿ä¸­...</div>
      <div id="next-update"></div>
      <div class="bar-wrap"><div class="bar-fill" id="bar-fill" style="width:100%"></div></div>
    </div>
  </header>

  <!-- å¤©æ°—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="section-label">ğŸŒ¡ å¤©æ°—äºˆå ±ï¼ˆ3æ—¥é–“ï¼‰</div>
  <div class="grid" id="grid-wx">
    <div class="card"><div class="loading-wrap"><div class="spinner"></div>å–å¾—ä¸­...</div></div>
    <div class="card"><div class="loading-wrap"><div class="spinner"></div>å–å¾—ä¸­...</div></div>
  </div>

  <!-- ã‚°ãƒ«ãƒ¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <div class="section-label">ğŸ½ ä»Šå­£ãŠã™ã™ã‚ã‚°ãƒ«ãƒ¡ TOP3ï¼ˆ2ã€œ3æœˆï¼‰</div>
  <div class="grid" id="grid-food">
    <div class="card"><div class="loading-wrap"><div class="spinner"></div></div></div>
    <div class="card"><div class="loading-wrap"><div class="spinner"></div></div></div>
  </div>

  <footer>
    å¤©æ°—ãƒ‡ãƒ¼ã‚¿: <a href="https://open-meteo.com/" target="_blank">Open-Meteo</a>
    &nbsp;|&nbsp; ã‚°ãƒ«ãƒ¡: 2ã€œ3æœˆãŠã™ã™ã‚ TOP3 &nbsp;|&nbsp; 1æ™‚é–“ã”ã¨è‡ªå‹•æ›´æ–°
  </footer>
</div>

<script>
const LOCATIONS = [
  { name:'è±Šæ´²',   sub:'æ±äº¬éƒ½æ±Ÿæ±åŒº', icon:'ğŸ¡', lat:35.6453, lon:139.7957, foodKey:'toyosu' },
  { name:'å²é˜œå¸‚', sub:'å²é˜œçœŒå²é˜œå¸‚', icon:'ğŸ¯', lat:35.4232, lon:136.7608, foodKey:'gifu'   }
];
const REFRESH_MS = 60 * 60 * 1000;

const RESTAURANTS = {
  toyosu: [
    { name:'å¯¿å¸ å¤§ è±Šæ´²åº—',  point:'ğŸ£ æ—¬ã®ç™½èº«ãƒ»ç‰¡è £æ¡ã‚Š â€” æ˜¥å­£é™å®š',     genre:'å¯¿å¸',   price:'Â¥3,500ã€œ', stars:4.8, url:'https://tabelog.com/tokyo/A1313/A131301/rstLst/?vs=1&sa=è±Šæ´²&sk=å¯¿å¸+å¤§' },
    { name:'è±Šæ´² é­šãŒã—é£Ÿå ‚', point:'ğŸ  ãƒã‚°ãƒ­ä¸­è½ã¡ä¸¼ãƒ»å¯’ãƒ–ãƒªç‚™ã‚Šå®šé£Ÿ',    genre:'æµ·é®®ä¸¼', price:'Â¥1,200ã€œ', stars:4.7, url:'https://tabelog.com/tokyo/A1313/A131301/rstLst/?vs=1&sa=è±Šæ´²&sk=é­šãŒã—é£Ÿå ‚' },
    { name:'ç„¼ãé³¥ è±Šæ´²ä¸€ç•ª', point:'ğŸ— æœã€†åœ°é¶ã‚³ãƒ¼ã‚¹ 2ã€œ3æœˆé™å®š',         genre:'ç„¼ãé³¥', price:'Â¥2,500ã€œ', stars:4.5, url:'https://tabelog.com/tokyo/A1313/A131301/rstLst/?vs=1&sa=è±Šæ´²&sk=ç„¼ãé³¥' },
  ],
  gifu: [
    { name:'é®æ–™ç† å·åŸç”º æ˜ç¥ä¸¸', point:'ğŸŸ å¥¥é£›é¨¨ç”£ å¤©ç„¶ã‚¢ãƒã‚´å¡©ç„¼ãå®šé£Ÿ',     genre:'å·é­šæ–™ç†', price:'Â¥2,000ã€œ', stars:4.8, url:'https://tabelog.com/gifu/A2101/A210101/rstLst/?vs=1&sa=å²é˜œå¸‚&sk=é®æ–™ç†' },
    { name:'ã¿ãã‹ã¤ å²é˜œå±‹',      point:'ğŸ¥© é£›é¨¨ç‰›ã¿ãã‹ã¤è†³ â€” å†¬ã®æ—¨å‘³å‡ç¸®',  genre:'ã¿ãã‹ã¤', price:'Â¥1,600ã€œ', stars:4.7, url:'https://tabelog.com/gifu/A2101/A210101/rstLst/?vs=1&sa=å²é˜œå¸‚&sk=ã¿ãã‹ã¤' },
    { name:'å²é˜œã‚‰ãƒ¼ã‚ã‚“ ä¸¸ãƒ‡ãƒ–',  point:'ğŸœ é†¤æ²¹ä¸­è¯ãã° è€èˆ—ã®å†¬é™å®šã‚ã‚“ã‹ã‘', genre:'ãƒ©ãƒ¼ãƒ¡ãƒ³', price:'Â¥800ã€œ',  stars:4.6, url:'https://tabelog.com/gifu/A2101/A210101/rstLst/?vs=1&sa=å²é˜œå¸‚&sk=ãƒ©ãƒ¼ãƒ¡ãƒ³' },
  ]
};

function wInfo(code, isDay=true) {
  const m = {
    0:['â˜€ï¸','å¿«æ™´'], 1:['ğŸŒ¤','ã»ã¼æ™´ã‚Œ'], 2:['â›…','æ™´ã‚Œæ™‚ã€…æ›‡ã‚Š'], 3:['â˜ï¸','æ›‡ã‚Š'],
    45:['ğŸŒ«','éœ§'], 48:['ğŸŒ«','éœ§æ°·'],
    51:['ğŸŒ¦','éœ§é›¨ï¼ˆå¼±ï¼‰'], 53:['ğŸŒ¦','éœ§é›¨'], 55:['ğŸŒ§','éœ§é›¨ï¼ˆå¼·ï¼‰'],
    61:['ğŸŒ§','é›¨ï¼ˆå¼±ï¼‰'],  63:['ğŸŒ§','é›¨'],   65:['ğŸŒ§','å¤§é›¨'],
    71:['ğŸŒ¨','å°é›ª'], 73:['â„ï¸','é›ª'], 75:['â„ï¸','å¤§é›ª'], 77:['ğŸŒ¨','éœ§é›ª'],
    80:['ğŸŒ¦','ã«ã‚ã‹é›¨'], 81:['ğŸŒ¦','ã«ã‚ã‹é›¨'], 82:['â›ˆ','ã«ã‚ã‹é›¨ï¼ˆå¼·ï¼‰'],
    85:['ğŸŒ¨','ã«ã‚ã‹é›ª'], 86:['ğŸŒ¨','ã«ã‚ã‹å¤§é›ª'],
    95:['â›ˆ','é›·é›¨'], 96:['â›ˆ','é›·é›¨+ã²ã‚‡ã†'], 99:['â›ˆ','æ¿€ã—ã„é›·é›¨']
  };
  if (code===0) return { emoji: isDay?'â˜€ï¸':'ğŸŒ™', desc:'å¿«æ™´' };
  if (code===1) return { emoji: isDay?'ğŸŒ¤':'ğŸŒ™', desc:'ã»ã¼æ™´ã‚Œ' };
  const r = m[code];
  return r ? { emoji:r[0], desc:r[1] } : { emoji:'â“', desc:'ä¸æ˜' };
}

function windDir(deg) {
  return ['åŒ—','åŒ—åŒ—æ±','åŒ—æ±','æ±åŒ—æ±','æ±','æ±å—æ±','å—æ±','å—å—æ±',
          'å—','å—å—è¥¿','å—è¥¿','è¥¿å—è¥¿','è¥¿','è¥¿åŒ—è¥¿','åŒ—è¥¿','åŒ—åŒ—è¥¿'][Math.round(deg/22.5)%16];
}

async function fetchWeather(loc) {
  const u = new URL('https://api.open-meteo.com/v1/forecast');
  u.searchParams.set('latitude',  loc.lat);
  u.searchParams.set('longitude', loc.lon);
  u.searchParams.set('current', [
    'temperature_2m','relative_humidity_2m','apparent_temperature',
    'weather_code','wind_speed_10m','wind_direction_10m','is_day'
  ].join(','));
  u.searchParams.set('daily', [
    'weather_code','temperature_2m_max','temperature_2m_min','precipitation_probability_max'
  ].join(','));
  u.searchParams.set('timezone', 'Asia/Tokyo');
  u.searchParams.set('forecast_days', '3');
  const res = await fetch(u.toString());
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}

function wxCardHTML(loc, data) {
  const c   = data.current;
  const day = c.is_day === 1;
  const cw  = wInfo(c.weather_code, day);
  const DN  = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];

  const days3 = data.daily.time.slice(0,3).map((t, i) => {
    const d    = new Date(t);
    const dw   = wInfo(data.daily.weather_code[i]);
    const rain = data.daily.precipitation_probability_max[i] ?? 0;
    const hi   = Math.round(data.daily.temperature_2m_max[i]);
    const lo   = Math.round(data.daily.temperature_2m_min[i]);
    const lbl  = i===0 ? 'ä»Šæ—¥' : i===1 ? 'æ˜æ—¥' : `${d.getMonth()+1}/${d.getDate()}ï¼ˆ${DN[d.getDay()]}ï¼‰`;
    const badge = i===0 ? '<div class="today-badge">TODAY</div>' : '';
    return `
      <div class="day-col${i===0?' today':''}">
        ${badge}
        <div class="dc-label">${lbl}</div>
        <div class="dc-emoji">${dw.emoji}</div>
        <div class="dc-wx">${dw.desc}</div>
        <div class="dc-temps">
          <span class="dc-hi">${hi}Â°</span>
          <span class="dc-lo">${lo}Â°</span>
        </div>
        <div class="dc-rain-row">
          <span class="dc-rain-pct">ğŸ’§${rain}%</span>
          <div class="dc-rain-track">
            <div class="dc-rain-bar" style="width:${rain}%"></div>
          </div>
        </div>
      </div>`;
  }).join('');

  return `
    <div class="card-head wx">
      <span class="ch-icon">${loc.icon}</span>
      <span class="ch-name">${loc.name}</span>
      <span class="ch-sub">${loc.sub}</span>
    </div>
    <div class="wx-now">
      <div class="wx-left">
        <div class="wx-emoji">${cw.emoji}</div>
        <div class="wx-desc">${cw.desc}</div>
      </div>
      <div class="wx-center">
        <div class="wx-temp-row">
          <span class="wx-temp">${Math.round(c.temperature_2m)}</span>
          <span class="wx-unit">Â°C</span>
        </div>
        <div class="wx-meta">
          <span class="wm">ğŸŒ¡ ä½“æ„Ÿ <strong>${Math.round(c.apparent_temperature)}Â°C</strong></span>
          <span class="wm">ğŸ’§ æ¹¿åº¦ <strong>${c.relative_humidity_2m}%</strong></span>
          <span class="wm">ğŸ’¨ é¢¨é€Ÿ <strong>${c.wind_speed_10m} km/h</strong></span>
          <span class="wm">ğŸ§­ é¢¨å‘ <strong>${windDir(c.wind_direction_10m)}</strong></span>
        </div>
      </div>
    </div>
    <div class="wx-3days">${days3}</div>`;
}

function foodCardHTML(loc) {
  const rCls = i => ['r1','r2','r3'][i] ?? 'r3';
  const list = RESTAURANTS[loc.foodKey];
  const items = list.map((r, i) => `
    <div class="f-item">
      <div class="f-rank ${rCls(i)}">${i+1}</div>
      <div class="f-body">
        <div class="f-name"><a href="${r.url}" target="_blank" rel="noopener">${r.name}</a></div>
        <div class="f-point">${r.point}</div>
      </div>
      <div class="f-right">
        <span class="f-genre">${r.genre}</span>
        <span class="f-score">â˜… ${r.stars}</span>
        <span class="f-price">${r.price}</span>
      </div>
    </div>`).join('');

  return `
    <div class="card-head gourmet">
      <span class="ch-icon">${loc.icon}</span>
      <span class="ch-name">${loc.name} â€” ä»Šå­£ãŠã™ã™ã‚</span>
      <span class="ch-tag">ğŸŒ¸ 2ã€œ3æœˆ TOP3</span>
    </div>
    <div class="food-list">${items}</div>`;
}

let countdownTimer = null, nextRefreshAt = null;

async function render() {
  const gwx   = document.getElementById('grid-wx');
  const gfood = document.getElementById('grid-food');
  const loading = `<div class="card"><div class="loading-wrap"><div class="spinner"></div>å–å¾—ä¸­...</div></div>`;
  gwx.innerHTML   = loading.repeat(3);
  gfood.innerHTML = loading.repeat(3);
  document.getElementById('last-updated').textContent = 'æ›´æ–°ä¸­...';
  document.getElementById('next-update').textContent  = '';

  try {
    const results = await Promise.all(LOCATIONS.map(fetchWeather));

    gwx.innerHTML   = '';
    gfood.innerHTML = '';

    results.forEach((data, i) => {
      const wx = document.createElement('div');
      wx.className = 'card';
      wx.innerHTML = wxCardHTML(LOCATIONS[i], data);
      gwx.appendChild(wx);

      const food = document.createElement('div');
      food.className = 'card';
      food.innerHTML = foodCardHTML(LOCATIONS[i]);
      gfood.appendChild(food);
    });

    document.getElementById('last-updated').textContent =
      `æœ€çµ‚æ›´æ–° ${new Date().toLocaleTimeString('ja-JP')}`;
    nextRefreshAt = Date.now() + REFRESH_MS;
    startCountdown();

  } catch(err) {
    gwx.innerHTML = `<div class="card" style="grid-column:span 3">
      <div class="loading-wrap" style="color:#c0392b">âš ï¸ ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—: ${err.message}</div>
    </div>`;
    document.getElementById('last-updated').textContent = 'å–å¾—å¤±æ•—';
    console.error(err);
  }
}

function startCountdown() {
  if (countdownTimer) clearInterval(countdownTimer);
  const fill  = document.getElementById('bar-fill');
  const label = document.getElementById('next-update');
  countdownTimer = setInterval(() => {
    const rem = nextRefreshAt - Date.now();
    if (rem <= 0) { clearInterval(countdownTimer); return; }
    fill.style.width = (rem / REFRESH_MS * 100) + '%';
    const m = Math.floor(rem / 60000);
    const s = Math.floor((rem % 60000) / 1000);
    label.textContent = `æ¬¡å›æ›´æ–°ã¾ã§ ${m}åˆ†${String(s).padStart(2,'0')}ç§’`;
  }, 1000);
}

setInterval(render, REFRESH_MS);
render();
</script>
</body>
</html>
